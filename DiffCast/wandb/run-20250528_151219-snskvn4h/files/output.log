============================================================
                 Experiment Start
============================================================
Distributed environment: NO
Num processes: 1
Process index: 0
Local process index: 0
Device: cuda

Mixed precision type: bf16

train data: 8929, valid data: 2110, test_data: 100
Pixel Scale: 255.0, Threshold: (16, 74, 133, 160, 181, 219)
Main Model Parameters: 48.72M
============ Running training ============
    Num examples = 8929
    Num Epochs = 2
    Instantaneous batch size per GPU = 8
    Total train batch size (w. parallel, distributed & accumulation) = 8
    Total optimization steps = 17858
optimizer: AdamW (
Parameter Group 0
    amsgrad: False
    betas: (0.9, 0.95)
    capturable: False
    decoupled_weight_decay: True
    differentiable: False
    eps: 1e-08
    foreach: None
    fused: None
    initial_lr: 0.0001
    lr: 0.0
    maximize: False
    weight_decay: 0.0
) with init lr: 0.0001
Data Loading Time: 0.3626723289489746
True
gpu_nums: 1, gpu_id: 0
Epoch 1/2, Step 1857/8929:  60%|█████████████████████████████████████████████████████▊                                   | 10787/17858 [51:04<36:15,  3.25it/s, lr=3.75e-5, total_loss=0.0123]Traceback (most recent call last):
backbone_net.torch_nn_module.decoder.cross_blocks.0.0.ffn_l.0.ffn_1.weight
backbone_net.torch_nn_module.decoder.cross_blocks.0.0.ffn_l.0.ffn_1.bias
backbone_net.torch_nn_module.decoder.cross_blocks.0.0.ffn_l.0.ffn_2.weight
backbone_net.torch_nn_module.decoder.cross_blocks.0.0.ffn_l.0.ffn_2.bias
Save checkpoint 8929 to /home/vatsal/NWM/DiffCast/Exps/basic_exps/Diffearthformer_sevir_None/checkpoints
 ========= Finisth one Epoch ==========
  File "/home/vatsal/NWM/DiffCast/run.py", line 577, in <module>
    main()
  File "/home/vatsal/NWM/DiffCast/run.py", line 566, in main
    exp.train()
  File "/home/vatsal/NWM/DiffCast/run.py", line 420, in train
    loss_dict = self._train_batch(batch)
  File "/home/vatsal/NWM/DiffCast/run.py", line 488, in _train_batch
    _, loss = self.model.predict(frames_in=frames_in, frames_gt=frames_out, compute_loss=True)
  File "/home/vatsal/NWM/DiffCast/models/diffcast.py", line 963, in predict
    loss = self._predict(frames_in, frames_gt)
  File "/home/vatsal/NWM/DiffCast/models/diffcast.py", line 1013, in _predict
    mu_for_gt_period_norm, _ = self.backbone_net.predict(frames_in_norm)
  File "/home/vatsal/NWM/DiffCast/models/earth_former.py", line 259, in predict
    out = self.torch_nn_module(frames_in)
  File "/home/vatsal/miniconda3/envs/earthformer/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/vatsal/miniconda3/envs/earthformer/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/vatsal/NWM/earth-forecasting-transformer/src/earthformer/cuboid_transformer/cuboid_transformer.py", line 3184, in forward
    mem_l, mem_global_vector_l = self.encoder(x, init_global_vectors)
  File "/home/vatsal/miniconda3/envs/earthformer/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/vatsal/miniconda3/envs/earthformer/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/vatsal/NWM/earth-forecasting-transformer/src/earthformer/cuboid_transformer/cuboid_transformer.py", line 1905, in forward
    x, global_vectors = l(x, global_vectors)
  File "/home/vatsal/miniconda3/envs/earthformer/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/vatsal/miniconda3/envs/earthformer/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/vatsal/NWM/earth-forecasting-transformer/src/earthformer/cuboid_transformer/cuboid_transformer.py", line 1115, in forward
    x_out, global_vectors_out = checkpoint.checkpoint(attn, x, global_vectors)
  File "/home/vatsal/miniconda3/envs/earthformer/lib/python3.9/site-packages/torch/_compile.py", line 51, in inner
    return disable_fn(*args, **kwargs)
  File "/home/vatsal/miniconda3/envs/earthformer/lib/python3.9/site-packages/torch/_dynamo/eval_frame.py", line 838, in _fn
    return fn(*args, **kwargs)
  File "/home/vatsal/miniconda3/envs/earthformer/lib/python3.9/site-packages/torch/utils/checkpoint.py", line 488, in checkpoint
    return CheckpointFunction.apply(function, preserve, *args)
  File "/home/vatsal/miniconda3/envs/earthformer/lib/python3.9/site-packages/torch/autograd/function.py", line 575, in apply
    return super().apply(*args, **kwargs)  # type: ignore[misc]
  File "/home/vatsal/miniconda3/envs/earthformer/lib/python3.9/site-packages/torch/utils/checkpoint.py", line 263, in forward
    outputs = run_function(*args)
  File "/home/vatsal/miniconda3/envs/earthformer/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/vatsal/miniconda3/envs/earthformer/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/vatsal/NWM/earth-forecasting-transformer/src/earthformer/cuboid_transformer/cuboid_transformer.py", line 845, in forward
    attn_score = q @ k.transpose(-2, -1)  # Shape (B, num_heads, num_cuboids, cuboid_volume, cuboid_volume)
KeyboardInterrupt
