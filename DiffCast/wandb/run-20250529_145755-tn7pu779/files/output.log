============================================================
                 Experiment Start
============================================================
Distributed environment: NO
Num processes: 1
Process index: 0
Local process index: 0
Device: cuda

Mixed precision type: bf16

train data: 17859, valid data: 20, test_data: 20
Pixel Scale: 255.0, Threshold: (16, 74, 133, 160, 181, 219)
Main Model Parameters: 48.72M
============ Running training ============
    Num examples = 17859
    Num Epochs = 1
    Instantaneous batch size per GPU = 4
    Total train batch size (w. parallel, distributed & accumulation) = 4
    Total optimization steps = 17859
optimizer: AdamW (
Parameter Group 0
    amsgrad: False
    betas: (0.9, 0.95)
    capturable: False
    decoupled_weight_decay: True
    differentiable: False
    eps: 1e-08
    foreach: None
    fused: None
    initial_lr: 0.0001
    lr: 0.0
    maximize: False
    weight_decay: 0.0
) with init lr: 0.0001
Data Loading Time: 0.19894981384277344
True
gpu_nums: 1, gpu_id: 0
sampling frags:: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:03<00:00,  3.96s/it]
backbone_net.torch_nn_module.decoder.cross_blocks.0.0.ffn_l.0.ffn_1.weight
backbone_net.torch_nn_module.decoder.cross_blocks.0.0.ffn_l.0.ffn_1.bias
backbone_net.torch_nn_module.decoder.cross_blocks.0.0.ffn_l.0.ffn_2.weight
backbone_net.torch_nn_module.decoder.cross_blocks.0.0.ffn_l.0.ffn_2.bias
 ========= Running Test at Step 10000 ==========
Save checkpoint 10000 to /home/vatsal/NWM/DiffCast/Exps/basic_exps/Diffearthformer_sevir_None/checkpoints
sampling frags:: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:03<00:00,  3.93s/it]
sampling frags:: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:03<00:00,  3.93s/it]
sampling frags:: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:03<00:00,  3.94s/it]
sampling frags:: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:03<00:00,  3.94s/it]
sampling frags:: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:03<00:00,  3.94s/it]
sampling frags:: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:03<00:00,  3.94s/it]
sampling frags:: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:03<00:00,  3.94s/it]
sampling frags:: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:03<00:00,  3.93s/it]
sampling frags:: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:03<00:00,  3.94s/it]
sampling frags:: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:03<00:00,  3.94s/it]
sampling frags:: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:03<00:00,  3.94s/it]
sampling frags:: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:03<00:00,  3.94s/it]
sampling frags:: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:03<00:00,  3.94s/it]
sampling frags:: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:03<00:00,  3.94s/it]
sampling frags:: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:03<00:00,  3.94s/it]
sampling frags:: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:03<00:00,  3.94s/it]
sampling frags:: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:03<00:00,  3.94s/it]
sampling frags:: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:03<00:00,  3.96s/it]
sampling frags:: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:03<00:00,  3.94s/it]
Test Samples: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20/20 [01:37<00:00,  4.85s/it]
Test Samples: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 20/20 [01:37<00:00,  4.89s/it]
****************************** < Evaluation Results: > ******************************
Total 160 samples with 10 seq_len.
******************************************************************************************
====================Threshold: 16 with melthod 1====================
<CSI> : 0.47810264759195975; [0.58246763 0.56184254 0.52765323 0.49872714 0.47041036 0.45358545
 0.44133396 0.4291847  0.41396315 0.40185833]
<FAR> : 0.4347231093501308; [0.3484077  0.34879761 0.39077314 0.41738294 0.44990287 0.46532485
 0.46260781 0.47198198 0.49077172 0.50128047]
<POD> : 0.7508153497451964; [0.84592949 0.80370526 0.79760119 0.77596907 0.76455946 0.74942196
 0.71173392 0.69631849 0.68874407 0.67417058]
<HSS> : 0.5910750177330495; [0.69911603 0.68065234 0.64620976 0.61631581 0.58476752 0.56590998
 0.55332638 0.53912797 0.52035357 0.50497081]
< CSI_POOL 4x4 > : 0.5427985502551936; CSI_POOL 16x16: 0.650794218660561
====================Threshold: 74 with melthod 1====================
<CSI> : 0.3177302891305968; [0.43731283 0.40777448 0.37798688 0.34787898 0.31781197 0.2950463
 0.26990318 0.2567691  0.24139454 0.22542465]
<FAR> : 0.49289226006392683; [0.37641964 0.38716951 0.43391124 0.46040635 0.49632929 0.51554698
 0.52826279 0.55294333 0.57885376 0.59907969]
<POD> : 0.4527419914533818; [0.5941594  0.54928054 0.53217332 0.49472708 0.46272937 0.43008626
 0.38681607 0.37626565 0.36125555 0.33992668]
<HSS> : 0.4637098932101261; [0.5981466  0.56838211 0.53647435 0.50308468 0.46789383 0.44052834
 0.40942338 0.39214422 0.37149327 0.34952814]
< CSI_POOL 4x4 > : 0.3846096137058053; CSI_POOL 16x16: 0.5020742106476146
====================Threshold: 133 with melthod 1====================
<CSI> : 0.06839240812136572; [0.12929374 0.10798283 0.08940853 0.07461612 0.06340594 0.05856833
 0.0454866  0.04270284 0.03792044 0.03453871]
<FAR> : 0.8865379377095447; [0.79819617 0.82648276 0.85804214 0.87824612 0.8964557  0.89807047
 0.91593353 0.92277408 0.93182149 0.93935694]
<POD> : 0.1435045075957398; [0.26461892 0.22234005 0.19454225 0.16158642 0.14057398 0.12101594
 0.09017826 0.08719439 0.07871769 0.07427717]
<HSS> : 0.12439649040642593; [0.22694447 0.19296117 0.16204204 0.13670146 0.11699328 0.10843154
 0.08494777 0.07973016 0.07080665 0.06440636]
< CSI_POOL 4x4 > : 0.16832450187474823; CSI_POOL 16x16: 0.384083044982699
====================Threshold: 160 with melthod 1====================
<CSI> : 0.017553452042233512; [0.03940721 0.03339806 0.02210566 0.01936685 0.01949246 0.01487138
 0.01019052 0.00734282 0.00520156 0.004158  ]
<FAR> : 0.9761348142697134; [0.94758065 0.95315904 0.97038153 0.97414222 0.97434656 0.97924846
 0.98529412 0.98987982 0.99288678 0.99442897]
<POD> : 0.06112671156139075; [0.13700234 0.10424242 0.08016304 0.07162534 0.07507082 0.04986523
 0.03212291 0.02605863 0.01898734 0.01612903]
<HSS> : 0.03388513466232618; [0.0753906  0.06423097 0.04286268 0.03760614 0.03785328 0.02891875
 0.01980814 0.01424599 0.01000203 0.00793278]
< CSI_POOL 4x4 > : 0.07952641572657211; CSI_POOL 16x16: 0.22832661290322578
====================Threshold: 181 with melthod 1====================
<CSI> : 0.004709187854863397; [0.01388889 0.00644122 0.00692521 0.00847458 0.008      0.00155039
 0.00181159 0.         0.         0.        ]
<FAR> : 0.994627427939023; [0.98412698 0.99281867 0.99207607 0.99027553 0.99083969 0.99819495
 0.99794239 1.         1.         1.        ]
<POD> : 0.03579634117939699; [0.1        0.05882353 0.05208333 0.06185567 0.05940594 0.01086957
 0.01492537 0.         0.         0.        ]
<HSS> : 0.009274763278031523; [ 2.73268125e-02  1.27543544e-02  1.36924580e-02  1.67438423e-02
  1.58073090e-02  3.03596371e-03  3.57187324e-03 -5.76548807e-05
 -6.14809881e-05 -6.58443867e-05]
< CSI_POOL 4x4 > : 0.02136431784107946; CSI_POOL 16x16: 0.0873069173942243
====================Threshold: 219 with melthod 1====================
<CSI> : 0.001388888888888889; [0.         0.         0.01388889 0.         0.         0.
 0.         0.         0.         0.        ]
<FAR> : 0.9985507246376812; [1.         1.         0.98550725 1.         1.         1.
 1.         1.         1.         1.        ]
<POD> : 0.025; [0.   0.   0.25 0.   0.   0.   0.   0.   0.   0.  ]
<HSS> : 0.002738917777306287; [ 0.00000000e+00  0.00000000e+00  2.73944548e-02 -1.48407621e-06
  0.00000000e+00  0.00000000e+00  0.00000000e+00 -2.47047671e-06
 -1.32243013e-06  0.00000000e+00]
< CSI_POOL 4x4 > : 0.0042194092827004225; CSI_POOL 16x16: 0.012269938650306749
********************Overall Avg Metrics on Thresholds (16, 74, 133, 160, 181, 219)********************
[ avg_csi ] : 0.147979478938318; [ avg_far ] : 0.7972443789950033; [ avg_pod ] : 0.2448308169225176; [ avg_hss] : 0.20418003617787758
[ avg_csi_pool 4x4 ] : 0.20014046811434985; [ avg_csi_pool 16x16 ]: 0.31080915720643854
====================Losses with 10 seq_len====================
<MSE> : 246.07382202148438; [145.22574 158.53226 187.41866 213.71265 249.26314 266.43475 276.9304
 297.57535 321.11685 344.52866]
<MAE> : 7.455521583557129; [5.4164944 5.321867  6.2126584 6.8568673 8.050496  8.398827  8.04176
 8.3329525 8.730719  9.192571 ]
<RMSE> : 14.045324325561523; [10.81452  11.257727 12.311451 13.213063 14.386818 14.854874 15.029948
 15.589107 16.204159 16.791573]
<PSNR> : 26.75053358195381; [29.0669875  28.88981167 27.93889338 27.19706425 26.22400469 25.98191935
 26.06395017 25.7108536  25.37947808 25.05237314]
<SSIM> : 0.5259921031652789; [0.64829969 0.67392322 0.60499586 0.55412582 0.4512191  0.43682708
 0.49668346 0.48058461 0.46711108 0.44615113]
<CRPS> : 0.029237338106175632; [0.02124115 0.02087007 0.02436336 0.02688968 0.03157057 0.03293657
 0.03153632 0.03267825 0.03423811 0.0360493 ]
<LPIPS> : 0.2299913465976715; [0.18562981 0.18748514 0.20565037 0.21788009 0.23062554 0.24012086
 0.246357   0.2538212  0.26098824 0.2713551 ]
==========================================================================================
Test Results: {'csi': 0.147979478938318}
==============================
  File "/home/vatsal/NWM/DiffCast/run.py", line 576, in <module>
  File "/home/vatsal/NWM/DiffCast/run.py", line 565, in main
  File "/home/vatsal/NWM/DiffCast/run.py", line 422, in train
  File "/home/vatsal/miniconda3/envs/earthformer/lib/python3.9/site-packages/accelerate/accelerator.py", line 2146, in clip_grad_norm_
    return torch.nn.utils.clip_grad_norm_(parameters, max_norm, norm_type=norm_type)
  File "/home/vatsal/miniconda3/envs/earthformer/lib/python3.9/site-packages/torch/nn/utils/clip_grad.py", line 38, in _no_grad_wrapper
    return func(*args, **kwargs)
  File "/home/vatsal/miniconda3/envs/earthformer/lib/python3.9/site-packages/torch/nn/utils/clip_grad.py", line 219, in clip_grad_norm_
    total_norm = _get_total_norm(grads, norm_type, error_if_nonfinite, foreach)
  File "/home/vatsal/miniconda3/envs/earthformer/lib/python3.9/site-packages/torch/nn/utils/clip_grad.py", line 38, in _no_grad_wrapper
    return func(*args, **kwargs)
  File "/home/vatsal/miniconda3/envs/earthformer/lib/python3.9/site-packages/torch/nn/utils/clip_grad.py", line 91, in _get_total_norm
    norms.extend(torch._foreach_norm(device_tensors, norm_type))
KeyboardInterrupt
